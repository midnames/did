# Midnight DID Specification Draft v0.1

# Status of This Document

This is a draft document and may be updated, replaced or obsoleted by other documents at any time. It is inappropriate to cite this document as other than work in progress.

# Contributions

[IAMX AG](https://iamx.id/)  
Dammstrasse 16  
6300 Zug  
Switzerland  
<https://iamx.id/>

Contact: <contact@imax.id>

## Contributors:
- Dennis Mittmann

# Abstract

This specification describes a new DID method called Midnight for storing DIDs using blockchains as public storage, also referred to as Midnight DID. This specification conforms to the requirements specified in the [DIDs specification](https://www.w3.org/TR/did-core/) currently published by the W3C Credentials Community Group.

# Contents

1. [Conformance and Terminology](#1-conformance-and-terminology)
2. [Midnight DID Syntax](#2-Midnight-did-syntax)
3. [Identifiers](#3-identifiers)
4. [DID operations](#4-did-operations)
5. [Security Considerations](#5-security-considerations)
6. [Privacy Considerations](#6-privacy-considerations)
7. [Appendix](#7-appendix)

# 1. Conformance and Terminology

This specification assumes a fair degree of understanding of [W3C DIDs specification](https://www.w3.org/TR/did-core/).

The keywords "MUST", "MUST NOT", "SHOULD", "MAY", and "OPTIONAL" in this document are to be interpreted as described in [IETF RFC 2119](https://www.ietf.org/rfc/rfc2119).

# 2. Midnight DID Syntax

Midnight DID is a URI conforming to [IETF RFC 3986](https://www.ietf.org/rfc/rfc3986) and **SHOULD** be generated by each entity itself.

Midnight DID is generated in conformity with [W3C DIDs specification](https://www.w3.org/TR/did-core/).

Midnight UID (specific-idstring) is conforming to [IETF RFC 4122](https://www.ietf.org/rfc/rfc4122.txt)

The ABNF grammar used to generate the Midnight DID identifier is as follows:

```
Midnight-did = did:midnight:specific-idstring
specific-idstring = xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx

```

Below is an example of a Midnight DID:

```

did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453

```

## 2.2. Midnight DID document properties

An Midnight DID document can have three distinct properties:

- **created**: poperty with the Date when the document was created.
- **registered**: poperty with the Date when the document was registered.
- **update**: poperty with the Date when the document was updated.
- **deactivated**: : poperty with the Date when the DID was deactivated.

A deactivated Midnight DID can no longer be used and cannot be reactivated for use.

## 2.3. Midnight DID Document

Each Midnight DID will have a corresponding Midnight DID Document, which is a set of data describing this Midnight DID.

Below is the basic structure of the Midnight DID Document:

```json
{
  "context": ["https://www.w3.org/ns/did/v1"],
  "id": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453",
  "authentication": {
    "id": "",
    "type": "",
    "controller": "",
    "publicKeyMultibase": ""
  },
  "credentials": []
}
```

## 2.4. Context

Midnight DID document's **MUST** include a `@context` property.

The value of the @context property **MUST** be one or more URIs, where the value of the first URI **MUST** be [https://www.w3.org/ns/did/v1](https://www.w3.org/ns/did/v1). For more information, see [W3C DID specification](https://w3c.github.io/did-core/#production-0).

Below is an example in which the `@context` property has two values:

```json
{
  "@context": ["https://www.w3.org/ns/did/v1"]
}
```

# 3. Identifiers

Midnight DID document's **MUST** include an `id` property.

The value of the `id` property denotes the Midnight DID subject that the Midnight DID Document is about.

The value of `id` **MUST** be a valid Midnight DID. A Midnight DID **MUST** have exactly one DID subject.

```json
{
  "id": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453"
}
```

## 3.1. Verification Methods

An Midnight DID Document **MAY** include a `verificationMethod` property to specify a set of public keys linked to that Midnight DID.

Public and private key pairs can be used for the identity management, authorization, and verification of Midnight DID's. A Midnight DID can be linked to multiple public and private key pairs, and one pair of public and private keys can also be used to manage multiple Midnight DID's.

Every public key object linked to the `verificationMethod` property **MUST** include the fields `id`, `type`, `controller` and specific public key properties, and **MAY** include other additional properties.

Each linked public key has its own identifier specified using the field `id`. The value of `verificationMethod` **MUST NOT** contain multiple entries with the same `id`.

Bound public keys can be revoked. Revoked public keys **MUST NOT** be reactivated, but can still possess the original `id`.

The value of the `type` field represents the corresponding public key type. Midnight DID document's support `BIP32-Ed25519`.

The value of the `controller` field which identifies the controller of the corresponding private key **MUST** be a valid Midnight DID, implying that the public key is controlled by this Midnight DID.

The encoding formats that Midnight DID Documents support include `publicKeyHex` and `AdaAddress`. Public keys of all types **MUST** be expressed in these two formats.

Below is a specific example of the `verificationMethod` property:

```json
{
  "verificationMethod": [
    {
      "id": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453#keys-1",
      "type": "BIP32-Ed25519",
      "controller": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453",
      "publicKeyMultibase": "0xfbf38de9fb40edcdab412094d24fa39a314f3d3f52f5860e2509c32522eda30161fe70dfc9f90434d64bd976ede4f112d4f2d8e34d28fe48281663219d2ddac6"
    },
    {
      "id": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453#keys-1",
      "type": "BIP32-Ed25519",
      "controller": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453",
      "AdaAddress": "addr1qxjq9aj8hy29jkp9dxeepe88ksayl4kqw7qe8et33j6ucxmj2ldj3f0f2l3xrk8ep7hwvde3wa8l9w4wkp8wxfshta2sya6pxt"
    }
  ]
}
```


## 3.2. Authentication

Midnight DID Documents **SHOULD** include an `authentication` property to specify a set of verification methods.

A Midnight DID subject could add the `authentication` property in its corresponding Midnight DID Document to denote that the subject has authorized a set of verification methods for the purpose of authentication.

The associated value **MUST** be an ordered set of one or more verification methods. Each verification methods in the `authentication` property **MAY** be embedded or referenced.

Below is an example which refers to authentication keys in the two-way specified above:

```json
{
  ...
  "authentication": [
  "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453#keys-1",
  {
    "id": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453#keys-2",
    "type": "BIP32-Ed25519",
    "controller": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453",
    "publicKeyMultibase": "03a835599850544b4c0a222d594be5d59cf298f5a3fd90bff1c8caa064523745f3"
  }
  ],
}
```

## 3.3. Authorization and Delegation

In an Midnight DID Document, an **OPTIONAL** `controller` property is included to assign one or more delegates.

A Midnight DID can be delegated to and controlled by one or more distinct Midnight DID's.

A Midnight DID delegate has the necessary authorization to insert a new verification methods into the `authentication` property of the delegated Midnight DID.

It is worth noting that a Midnight DID Document can assign `controller` without defining the value of `authentication`.

The Midnight DID Document of the delegate **SHOULD** have a `authentication` property.

Below is a specific example representing that either `did:midnight:5Ee76017be7F983a520a778B413758A9DB49cBe9` or `did:midnight:9861eE37Ede3dCab070DF227155D86A7438d8Ed2` can act as a delegate of `did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453`:

```json
{
  ...
  "id": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453",
  "controller": [
    "did:midnight:5Ee76017be7F983a520a778B413758A9DB49cBe9",
    "did:midnight:9861eE37Ede3dCab070DF227155D86A7438d8Ed2"
  ],
}
```

## 3.4. Service Information

Midnight DID document's use an **OPTIONAL** `service` property to specify the service property.

Midnight DID's allow entities to add services and specify the relevant information of a service that is related to the particular Midnight DID, including fields such as the type of service and service endpoint.

This part is derived directly from [W3C DID specification](https://www.w3.org/TR/did-core/#services).

Below is a specific example:

```json
{
  ...
  "service": [
  {
    "id": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453#some-service",
    "type": "SomeServiceType",
    "serviceEndpoint": "Some URL"
  }
  ]
}
```

# 4. DID operations

All methods **SHOULD** include a property denoting the supported method which is executed against the current Midnight DID document. The property needs to specify a timestamp of the most recent change.

This part is derived directly from [W3C DID specification](https://www.w3.org/TR/did-core/#updated).

## 4.1. Create

Creation of the DID including the private & public key pair is done **off chain** on a device controlled by the holder.
Within the metadata of the DID document, a **created** property is added.
Midnight DID can be automatically created without registration for each Midnight  address.

```json
{
  "created": "2019-06-30T12:00:00Z"
}
```

As part of the **creation** operation, the initial Midnight DID document will be 25000000000000000written to blockchain ledger in order to register the DID.
Within the metadata of the DID document, a **registered** property is added.

```json
{
  "registered": "2019-06-30T12:00:00Z"
}
```

The DID Document will be written to the Midnight  Blockchain as part of the transaction meta data.

## 4.2. Read

1. The DID network identifier is "mainnet".
2. A lookup in the Midnight Ledger Database will reveal the DID Document by the DID ID.
3. Midnight provides a backend which provides a method called `didVerify` which will look up the DID Document in a copy of the Midnight Ledger on the connected Midnight node.
4. To make sure the result returned by invoking the `didVerify` function is trustworthy, the client could ask a sufficient number of nodes and compare each node's return value.

## 4.3. Update

Updating of an Midnight DID will generate new private & public key's and is done on a device controlled by the user.
Updating an Midnight DID Document is done by making a transaction which contains the old DID and writes a new DID as part of the transaction metadata into the blockchain ledger.
Within the metadata of the DID document, a **updated** property is added

```json
{
  "updated": "2019-06-30T12:00:00Z"
}
```

## 4.5. Deactivation

Deactivating an Midnight DID Document is done by making a transaction which contains the old DID and writes a new DID as part of the transaction metadata into the blockchain ledger.
Within the metadata of the DID document, a **deactivation** property is added.

```json
{
  "deactivated": "2019-06-30T12:00:00Z"
}
```

# 5. Security Considerations

The security of the Midnight model is based on the security of the underlying blockchain ledger. Currently, the only supported blockchain is Midnight.

The Midnight features mathematically verifiable security against attackers. Security properties for the protocol are comparable to those achieved by the bitcoin blockchain protocol. For more details on the protocol can be found in the white paper:  
https://midnight.network/#whitepaper

Midnight DID's will be stored in an address controlled by the holder. This ensures that third parties can't modify, register, update or deactivate the DID document controlled by the holder.

## 5.1. Binding to Physical Identity

A Midnight DID document stored on the Blockchain will never contain any personal information. Ownership is proofed by:

- Control over the blockchain address.
- Control over of the private key which is related to the public key referenced in the Midnight DID document.

## 5.2. DID document changes

As all Midnight DID methods are generated by a transaction which includes the previous DID, the DID document changes can be monitored by observing the global state of the blockchain ledger.

# 6. Privacy Considerations

## 6.1. Surveillance

In the public Midnight network, all transactions are visible by watching the blockchain.

## 6.2. Stored data compromise

The DID Document data and history is stored in the blockchain state.
The Blockchain state is secured by the consensus method. For details see the Midnight white paper: 
[https://eprint.iacr.org/2016/889.pdf](https://midnight.network/#whitepaper)

## 6.4. Identification

If personal information is added to the blockchain, potentially a viable credential, this can be permanently accessed. With enough identifying information, an identity can be deduced.

For this reason, it is very strongly suggested that personal information is not added to the blockchain.

Therefore, Midnight DID document will **NEVER** contain any personal Data.

## 6.3. Separation of concerns

DID's beeing purpose build, which means the holder will control several DID's for distinct Use Cases.

## 6.4. Traceability

To avoid traceability of a verifiable presentation, a new did document **can** be generated of during the generation of each verifiable presentation. For each new DID document, a new privat-public key pair can be generated. This avoids correlation-based tracing of the user.

## 6.5. Misattribution

Create, update and (if supported) deactivate DID operations require transactions signed by the private keys only owned by the DID controller and cannot be forged.

# 7. Appendix

A simple example of a Midnight DID Document is as follows:

```json
{
 "context": [
    "https://www.w3.org/ns/did/v1",
    "https://w3id.org/security/suites/ed25519-2020/v1"
  ],
  "id": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453",
  "updated": "2019-06-30T12:00:00Z",
  "authentication": [
    "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453#keys-1",
    {
      "id": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453#keys-2",
      "type": "BIP32-Ed25519",
      "controller": [
        "did:midnight:5Ee76017be7F983a520a778B413758A9DB49cBe9",
        "did:midnight:9861eE37Ede3dCab070DF227155D86A7438d8Ed2"
      ],
      "publicKeyMultibase": "03a835599850544b4c0a222d594be5d59cf298f5a3fd90bff1c8caa064523745f3"
    }
  ],
  "verificationMethod": [
    {
      "id": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453#keys-1",
      "type": "BIP32-Ed25519",
      "controller": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453",
      "publicKeyHex": "0xfbf38de9fb40edcdab412094d24fa39a314f3d3f52f5860e2509c32522eda30161fe70dfc9f90434d64bd976ede4f112d4f2d8e34d28fe48281663219d2ddac6"
    },
    {
      "id": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453#keys-1",
      "type": "BIP32-Ed25519",
      "controller": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453",
      "AdaAddress": "addr1qxjq9aj8hy29jkp9dxeepe88ksayl4kqw7qe8et33j6ucxmj2ldj3f0f2l3xrk8ep7hwvde3wa8l9w4wkp8wxfshta2sya6pxt"
    }
  ],
  "service": [
    {
      "id": "did:midnight:d36d6f76-e463-4e48-a97e-908edaee6453#some-service",
      "type": "SomeServiceType",
      "serviceEndpoint": "Some URL"
    }
  ],
  "credentials": [
    {
      "data": "debc879591e984d2f7521a414d1264a79135ea62fe97ad7abfffbaa2efd485ca",
      "publicKeyMultibase": "-----BEGIN RSA PUBLIC KEY-----\nMIIBCgKCAQEAs7Z/wvbS0Cg2AkdPJJ/cd8inoNUNJAZAIUlJPosyVruwMHLT707+\n6VTzV4qSQRMVQ1IJe22hQGLYqGvdN6TrXU5X3DsyyJxkBgHd35tOTSrUZDKOS7gX\n+yfj6YqRZvi+2Xfegj5kJX2hT/EOfYWO1KbFpjM+zovOQ9Um/ljwWsj9019Wv76m\nWhlpepKnR7k8tjHLdlM6iksbQltEpq79r2HEYj9hRKCoV5d1uWYd7906K1asN0zh\n8XroQESwu8Tp/kIhvXyP4WjxOJj2lh5ZpjtrJ3Qbk9ZPF7KNcAmEgqBo6fDz1Z9Q\ndlp6HTc2xuKPN1h913i5GdamCHpHphucMwIDAQAB\n-----END RSA PUBLIC KEY-----\n"
    }
  ]
}
```

## Normative References

[W3C-DID]

Decentralized Identifiers (DIDs) v1.0. W3C. Jul 2020. Working Draft. URL: https://www.w3.org/TR/did-core/

[RFC2119]

Keywords for use in RFCs to Indicate Requirement Levels. S. Bradner. IETF. March 1997. Best Current Practice. URL: https://tools.ietf.org/html/rfc2119

[RFC4122]

A Universally Unique Identifier (UUID) URN Namespace P. Leach July 2005 URL: https://www.ietf.org/rfc/rfc4122.txt

[RFC3986]

Uniform Resource Identifier (URI): Generic Syntax. T. Berners-Lee; R. Fielding; L. Masinter. IETF. JANUARY 2005. Standards Track. URL: https://tools.ietf.org/html/rfc3986
